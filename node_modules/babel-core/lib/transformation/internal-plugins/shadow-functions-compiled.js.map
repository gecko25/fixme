{"version":3,"sources":["shadow-functions.js"],"names":[],"mappings":"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","file":"shadow-functions-compiled.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"babel-runtime/helpers/interop-require-default\")[\"default\"];\n\nvar _interopRequireWildcard = require(\"babel-runtime/helpers/interop-require-wildcard\")[\"default\"];\n\nexports.__esModule = true;\n\nvar _plugin = require(\"../plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nexports[\"default\"] = new _plugin2[\"default\"]({\n  visitor: {\n    ThisExpression: function ThisExpression(path) {\n      remap(path, \"this\", function () {\n        return t.thisExpression();\n      });\n    },\n\n    ReferencedIdentifier: function ReferencedIdentifier(path) {\n      if (path.node.name === \"arguments\") {\n        remap(path, \"arguments\", function () {\n          return t.identifier(\"arguments\");\n        });\n      }\n    }\n  }\n});\n\nfunction shouldShadow(path, shadowPath) {\n  if (path.is(\"_forceShadow\")) {\n    return true;\n  } else {\n    return shadowPath;\n  }\n}\n\nfunction remap(path, key, create) {\n  // ensure that we're shadowed\n  var shadowPath = path.inShadow(key);\n  if (!shouldShadow(path, shadowPath)) return;\n\n  var shadowFunction = path.node._shadowedFunctionLiteral;\n\n  var currentFunction = undefined;\n  var passedShadowFunction = false;\n\n  var fnPath = path.findParent(function (path) {\n    if (path.isProgram() || path.isFunction()) {\n      // catch current function in case this is the shadowed one and we can ignore it\n      currentFunction = currentFunction || path;\n    }\n\n    if (path.isProgram()) {\n      passedShadowFunction = true;\n\n      return true;\n    } else if (path.isFunction() && !path.isArrowFunctionExpression()) {\n      if (shadowFunction) {\n        if (path === shadowFunction || path.node === shadowFunction.node) return true;\n      } else {\n        if (!path.is(\"shadow\")) return true;\n      }\n\n      passedShadowFunction = true;\n      return false;\n    }\n\n    return false;\n  });\n\n  if (shadowFunction && fnPath.isProgram() && !shadowFunction.isProgram()) {\n    // If the shadow wasn't found, take the closest function as a backup.\n    // This is a bit of a hack, but it will allow the parameter transforms to work properly\n    // without introducing yet another shadow-controlling flag.\n    fnPath = path.findParent(function (p) {\n      return p.isProgram() || p.isFunction();\n    });\n  }\n\n  // no point in realiasing if we're in this function\n  if (fnPath === currentFunction) return;\n\n  // If the only functions that were encountered are arrow functions, skip remapping the\n  // binding since arrow function syntax already does that.\n  if (!passedShadowFunction) return;\n\n  var cached = fnPath.getData(key);\n  if (cached) return path.replaceWith(cached);\n\n  var init = create();\n  var id = path.scope.generateUidIdentifier(key);\n\n  fnPath.setData(key, id);\n  fnPath.scope.push({ id: id, init: init });\n\n  return path.replaceWith(id);\n}\nmodule.exports = exports[\"default\"];"]}