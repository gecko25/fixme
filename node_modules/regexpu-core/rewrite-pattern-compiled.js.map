{"version":3,"sources":["rewrite-pattern.js"],"names":[],"mappings":"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","file":"rewrite-pattern-compiled.js","sourcesContent":["var generate = require('regjsgen').generate;\nvar parse = require('regjsparser').parse;\nvar regenerate = require('regenerate');\nvar iuMappings = require('./data/iu-mappings.json');\nvar ESCAPE_SETS = require('./data/character-class-escape-sets.js');\n\nfunction getCharacterClassEscapeSet(character) {\n\tif (unicode) {\n\t\tif (ignoreCase) {\n\t\t\treturn ESCAPE_SETS.UNICODE_IGNORE_CASE[character];\n\t\t}\n\t\treturn ESCAPE_SETS.UNICODE[character];\n\t}\n\treturn ESCAPE_SETS.REGULAR[character];\n}\n\nvar object = {};\nvar hasOwnProperty = object.hasOwnProperty;\nfunction has(object, property) {\n\treturn hasOwnProperty.call(object, property);\n}\n\n// Prepare a Regenerate set containing all code points, used for negative\n// character classes (if any).\nvar UNICODE_SET = regenerate().addRange(0x0, 0x10FFFF);\n// Without the `u` flag, the range stops at 0xFFFF.\n// https://mths.be/es6#sec-pattern-semantics\nvar BMP_SET = regenerate().addRange(0x0, 0xFFFF);\n\n// Prepare a Regenerate set containing all code points that are supposed to be\n// matched by `/./u`. https://mths.be/es6#sec-atom\nvar DOT_SET_UNICODE = UNICODE_SET.clone() // all Unicode code points\n\t.remove(\n\t\t// minus `LineTerminator`s (https://mths.be/es6#sec-line-terminators):\n\t\t0x000A, // Line Feed <LF>\n\t\t0x000D, // Carriage Return <CR>\n\t\t0x2028, // Line Separator <LS>\n\t\t0x2029  // Paragraph Separator <PS>\n\t);\n// Prepare a Regenerate set containing all code points that are supposed to be\n// matched by `/./` (only BMP code points).\nvar DOT_SET = DOT_SET_UNICODE.clone()\n\t.intersection(BMP_SET);\n\n// Add a range of code points + any case-folded code points in that range to a\n// set.\nregenerate.prototype.iuAddRange = function(min, max) {\n\tvar $this = this;\n\tdo {\n\t\tvar folded = caseFold(min);\n\t\tif (folded) {\n\t\t\t$this.add(folded);\n\t\t}\n\t} while (++min <= max);\n\treturn $this;\n};\n\nfunction assign(target, source) {\n\tfor (var key in source) {\n\t\t// Note: `hasOwnProperty` is not needed here.\n\t\ttarget[key] = source[key];\n\t}\n}\n\nfunction update(item, pattern) {\n\t// TODO: Test if memoizing `pattern` here is worth the effort.\n\tif (!pattern) {\n\t\treturn;\n\t}\n\tvar tree = parse(pattern, '');\n\tswitch (tree.type) {\n\t\tcase 'characterClass':\n\t\tcase 'group':\n\t\tcase 'value':\n\t\t\t// No wrapping needed.\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t// Wrap the pattern in a non-capturing group.\n\t\t\ttree = wrap(tree, pattern);\n\t}\n\tassign(item, tree);\n}\n\nfunction wrap(tree, pattern) {\n\t// Wrap the pattern in a non-capturing group.\n\treturn {\n\t\t'type': 'group',\n\t\t'behavior': 'ignore',\n\t\t'body': [tree],\n\t\t'raw': '(?:' + pattern + ')'\n\t};\n}\n\nfunction caseFold(codePoint) {\n\treturn has(iuMappings, codePoint) ? iuMappings[codePoint] : false;\n}\n\nvar ignoreCase = false;\nvar unicode = false;\nfunction processCharacterClass(characterClassItem) {\n\tvar set = regenerate();\n\tvar body = characterClassItem.body.forEach(function(item) {\n\t\tswitch (item.type) {\n\t\t\tcase 'value':\n\t\t\t\tset.add(item.codePoint);\n\t\t\t\tif (ignoreCase && unicode) {\n\t\t\t\t\tvar folded = caseFold(item.codePoint);\n\t\t\t\t\tif (folded) {\n\t\t\t\t\t\tset.add(folded);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'characterClassRange':\n\t\t\t\tvar min = item.min.codePoint;\n\t\t\t\tvar max = item.max.codePoint;\n\t\t\t\tset.addRange(min, max);\n\t\t\t\tif (ignoreCase && unicode) {\n\t\t\t\t\tset.iuAddRange(min, max);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'characterClassEscape':\n\t\t\t\tset.add(getCharacterClassEscapeSet(item.value));\n\t\t\t\tbreak;\n\t\t\t// The `default` clause is only here as a safeguard; it should never be\n\t\t\t// reached. Code coverage tools should ignore it.\n\t\t\t/* istanbul ignore next */\n\t\t\tdefault:\n\t\t\t\tthrow Error('Unknown term type: ' + item.type);\n\t\t}\n\t});\n\tif (characterClassItem.negative) {\n\t\tset = (unicode ? UNICODE_SET : BMP_SET).clone().remove(set);\n\t}\n\tupdate(characterClassItem, set.toString());\n\treturn characterClassItem;\n}\n\nfunction processTerm(item) {\n\tswitch (item.type) {\n\t\tcase 'dot':\n\t\t\tupdate(\n\t\t\t\titem,\n\t\t\t\t(unicode ? DOT_SET_UNICODE : DOT_SET).toString()\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'characterClass':\n\t\t\titem = processCharacterClass(item);\n\t\t\tbreak;\n\t\tcase 'characterClassEscape':\n\t\t\tupdate(\n\t\t\t\titem,\n\t\t\t\tgetCharacterClassEscapeSet(item.value).toString()\n\t\t\t);\n\t\t\tbreak;\n\t\tcase 'alternative':\n\t\tcase 'disjunction':\n\t\tcase 'group':\n\t\tcase 'quantifier':\n\t\t\titem.body = item.body.map(processTerm);\n\t\t\tbreak;\n\t\tcase 'value':\n\t\t\tvar codePoint = item.codePoint;\n\t\t\tvar set = regenerate(codePoint);\n\t\t\tif (ignoreCase && unicode) {\n\t\t\t\tvar folded = caseFold(codePoint);\n\t\t\t\tif (folded) {\n\t\t\t\t\tset.add(folded);\n\t\t\t\t}\n\t\t\t}\n\t\t\tupdate(item, set.toString());\n\t\t\tbreak;\n\t\tcase 'anchor':\n\t\tcase 'empty':\n\t\tcase 'group':\n\t\tcase 'reference':\n\t\t\t// Nothing to do here.\n\t\t\tbreak;\n\t\t// The `default` clause is only here as a safeguard; it should never be\n\t\t// reached. Code coverage tools should ignore it.\n\t\t/* istanbul ignore next */\n\t\tdefault:\n\t\t\tthrow Error('Unknown term type: ' + item.type);\n\t}\n\treturn item;\n};\n\nmodule.exports = function(pattern, flags) {\n\tvar tree = parse(pattern, flags);\n\tignoreCase = flags ? flags.indexOf('i') > -1 : false;\n\tunicode = flags ? flags.indexOf('u') > -1 : false;\n\tassign(tree, processTerm(tree));\n\treturn generate(tree);\n};\n"]}