{"version":3,"sources":["context.js"],"names":[],"mappings":"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","file":"context-compiled.js","sourcesContent":["\"use strict\";\n\nvar _classCallCheck = require(\"babel-runtime/helpers/class-call-check\")[\"default\"];\n\nvar _getIterator = require(\"babel-runtime/core-js/get-iterator\")[\"default\"];\n\nvar _interopRequireDefault = require(\"babel-runtime/helpers/interop-require-default\")[\"default\"];\n\nvar _interopRequireWildcard = require(\"babel-runtime/helpers/interop-require-wildcard\")[\"default\"];\n\nexports.__esModule = true;\n\nvar _path = require(\"./path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nvar testing = process.env.NODE_ENV === \"test\";\n\nvar TraversalContext = (function () {\n  function TraversalContext(scope, opts, state, parentPath) {\n    _classCallCheck(this, TraversalContext);\n\n    this.queue = null;\n\n    this.parentPath = parentPath;\n    this.scope = scope;\n    this.state = state;\n    this.opts = opts;\n  }\n\n  /**\n   * This method does a simple check to determine whether or not we really need to attempt\n   * visit a node. This will prevent us from constructing a NodePath.\n   */\n\n  TraversalContext.prototype.shouldVisit = function shouldVisit(node) {\n    var opts = this.opts;\n    if (opts.enter || opts.exit) return true;\n\n    // check if we have a visitor for this node\n    if (opts[node.type]) return true;\n\n    // check if we're going to traverse into this node\n    var keys = t.VISITOR_KEYS[node.type];\n    if (!keys || !keys.length) return false;\n\n    // we need to traverse into this node so ensure that it has children to traverse into!\n    for (var _iterator = keys, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _getIterator(_iterator);;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var key = _ref;\n\n      if (node[key]) return true;\n    }\n\n    return false;\n  };\n\n  TraversalContext.prototype.create = function create(node, obj, key, listKey) {\n    return _path2[\"default\"].get({\n      parentPath: this.parentPath,\n      parent: node,\n      container: obj,\n      key: key,\n      listKey: listKey\n    });\n  };\n\n  TraversalContext.prototype.maybeQueue = function maybeQueue(path, notPriority) {\n    if (this.trap) {\n      throw new Error(\"Infinite cycle detected\");\n    }\n\n    if (this.queue) {\n      if (notPriority) {\n        this.queue.push(path);\n      } else {\n        this.priorityQueue.push(path);\n      }\n    }\n  };\n\n  TraversalContext.prototype.visitMultiple = function visitMultiple(container, parent, listKey) {\n    // nothing to traverse!\n    if (container.length === 0) return false;\n\n    var queue = [];\n\n    // build up initial queue\n    for (var key = 0; key < container.length; key++) {\n      var node = container[key];\n      if (node && this.shouldVisit(node)) {\n        queue.push(this.create(parent, container, key, listKey));\n      }\n    }\n\n    return this.visitQueue(queue);\n  };\n\n  TraversalContext.prototype.visitSingle = function visitSingle(node, key) {\n    if (this.shouldVisit(node[key])) {\n      return this.visitQueue([this.create(node, node, key)]);\n    } else {\n      return false;\n    }\n  };\n\n  TraversalContext.prototype.visitQueue = function visitQueue(queue) {\n    // set queue\n    this.queue = queue;\n    this.priorityQueue = [];\n\n    var visited = [];\n    var stop = false;\n\n    // visit the queue\n    for (var _i2 = 0; _i2 < queue.length; _i2++) {\n      var path = queue[_i2];\n      path.resync();\n\n      if (path.contexts.length === 0 || path.contexts[path.contexts.length - 1] !== this) {\n        // The context might already have been pushed when this path was inserted and queued.\n        // If we always re-pushed here, we could get duplicates and risk leaving contexts\n        // on the stack after the traversal has completed, which could break things.\n        path.pushContext(this);\n      }\n\n      // this path no longer belongs to the tree\n      if (path.key === null) continue;\n\n      if (testing && queue.length >= 1000) {\n        this.trap = true;\n      }\n\n      // ensure we don't visit the same node twice\n      if (visited.indexOf(path.node) >= 0) continue;\n      visited.push(path.node);\n\n      if (path.visit()) {\n        stop = true;\n        break;\n      }\n\n      if (this.priorityQueue.length) {\n        stop = this.visitQueue(this.priorityQueue);\n        this.priorityQueue = [];\n        this.queue = queue;\n        if (stop) break;\n      }\n    }\n\n    // clear queue\n    for (var _i3 = 0; _i3 < queue.length; _i3++) {\n      var path = queue[_i3];\n      path.popContext();\n    }\n\n    // clear queue\n    this.queue = null;\n\n    return stop;\n  };\n\n  TraversalContext.prototype.visit = function visit(node, key) {\n    var nodes = node[key];\n    if (!nodes) return false;\n\n    if (Array.isArray(nodes)) {\n      return this.visitMultiple(nodes, node, key);\n    } else {\n      return this.visitSingle(node, key);\n    }\n  };\n\n  return TraversalContext;\n})();\n\nexports[\"default\"] = TraversalContext;\nmodule.exports = exports[\"default\"];"]}