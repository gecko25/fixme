{"version":3,"sources":["visitors.js"],"names":[],"mappings":"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","file":"visitors-compiled.js","sourcesContent":["\"use strict\";\n\nvar _Object$keys = require(\"babel-runtime/core-js/object/keys\")[\"default\"];\n\nvar _getIterator = require(\"babel-runtime/core-js/get-iterator\")[\"default\"];\n\nvar _interopRequireWildcard = require(\"babel-runtime/helpers/interop-require-wildcard\")[\"default\"];\n\nvar _interopRequireDefault = require(\"babel-runtime/helpers/interop-require-default\")[\"default\"];\n\nexports.__esModule = true;\nexports.explode = explode;\nexports.verify = verify;\nexports.merge = merge;\n\nvar _pathLibVirtualTypes = require(\"./path/lib/virtual-types\");\n\nvar virtualTypes = _interopRequireWildcard(_pathLibVirtualTypes);\n\nvar _babelMessages = require(\"babel-messages\");\n\nvar messages = _interopRequireWildcard(_babelMessages);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nvar _lodashLangClone = require(\"lodash/lang/clone\");\n\nvar _lodashLangClone2 = _interopRequireDefault(_lodashLangClone);\n\n/**\n * explode() will take a visitor object with all of the various shorthands\n * that we support, and validates & normalizes it into a common format, ready\n * to be used in traversal\n *\n * The various shorthands are:\n * * `Identifier() { ... }` -> `Identifier: { enter() { ... } }`\n * * `\"Identifier|NumericLiteral\": { ... }` -> `Identifier: { ... }, NumericLiteral: { ... }`\n * * Aliases in `babel-types`: e.g. `Property: { ... }` -> `ObjectProperty: { ... }, ClassProperty: { ... }`\n *\n * Other normalizations are:\n * * Visitors of virtual types are wrapped, so that they are only visited when\n *   their dynamic check passes\n * * `enter` and `exit` functions are wrapped in arrays, to ease merging of\n *   visitors\n */\n\nfunction explode(visitor) {\n  if (visitor._exploded) return visitor;\n  visitor._exploded = true;\n\n  // normalise pipes\n  for (var nodeType in visitor) {\n    if (shouldIgnoreKey(nodeType)) continue;\n\n    var parts = nodeType.split(\"|\");\n    if (parts.length === 1) continue;\n\n    var fns = visitor[nodeType];\n    delete visitor[nodeType];\n\n    for (var _i = 0; _i < parts.length; _i++) {\n      var part = parts[_i];\n      visitor[part] = fns;\n    }\n  }\n\n  // verify data structure\n  verify(visitor);\n\n  // make sure there's no __esModule type since this is because we're using loose mode\n  // and it sets __esModule to be enumerable on all modules :(\n  delete visitor.__esModule;\n\n  // ensure visitors are objects\n  ensureEntranceObjects(visitor);\n\n  // ensure enter/exit callbacks are arrays\n  ensureCallbackArrays(visitor);\n\n  // add type wrappers\n\n  var _arr = _Object$keys(visitor);\n\n  for (var _i2 = 0; _i2 < _arr.length; _i2++) {\n    var nodeType = _arr[_i2];\n    if (shouldIgnoreKey(nodeType)) continue;\n\n    var wrapper = virtualTypes[nodeType];\n    if (!wrapper) continue;\n\n    // wrap all the functions\n    var fns = visitor[nodeType];\n    for (var type in fns) {\n      fns[type] = wrapCheck(wrapper, fns[type]);\n    }\n\n    // clear it from the visitor\n    delete visitor[nodeType];\n\n    if (wrapper.types) {\n      var _arr2 = wrapper.types;\n\n      for (var _i4 = 0; _i4 < _arr2.length; _i4++) {\n        var type = _arr2[_i4];\n        // merge the visitor if necessary or just put it back in\n        if (visitor[type]) {\n          mergePair(visitor[type], fns);\n        } else {\n          visitor[type] = fns;\n        }\n      }\n    } else {\n      mergePair(visitor, fns);\n    }\n  }\n\n  // add aliases\n  for (var nodeType in visitor) {\n    if (shouldIgnoreKey(nodeType)) continue;\n\n    var fns = visitor[nodeType];\n\n    var aliases = t.FLIPPED_ALIAS_KEYS[nodeType];\n\n    var deprecratedKey = t.DEPRECATED_KEYS[nodeType];\n    if (deprecratedKey) {\n      console.trace(\"Visitor defined for \" + nodeType + \" but it has been renamed to \" + deprecratedKey);\n      aliases = [deprecratedKey];\n    }\n\n    if (!aliases) continue;\n\n    // clear it from the visitor\n    delete visitor[nodeType];\n\n    for (var _iterator = aliases, _isArray = Array.isArray(_iterator), _i3 = 0, _iterator = _isArray ? _iterator : _getIterator(_iterator);;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i3 >= _iterator.length) break;\n        _ref = _iterator[_i3++];\n      } else {\n        _i3 = _iterator.next();\n        if (_i3.done) break;\n        _ref = _i3.value;\n      }\n\n      var alias = _ref;\n\n      var existing = visitor[alias];\n      if (existing) {\n        mergePair(existing, fns);\n      } else {\n        visitor[alias] = _lodashLangClone2[\"default\"](fns);\n      }\n    }\n  }\n\n  for (var nodeType in visitor) {\n    if (shouldIgnoreKey(nodeType)) continue;\n\n    ensureCallbackArrays(visitor[nodeType]);\n  }\n\n  return visitor;\n}\n\nfunction verify(visitor) {\n  if (visitor._verified) return;\n\n  if (typeof visitor === \"function\") {\n    throw new Error(messages.get(\"traverseVerifyRootFunction\"));\n  }\n\n  for (var nodeType in visitor) {\n    if (nodeType === \"enter\" || nodeType === \"exit\") {\n      validateVisitorMethods(nodeType, visitor[nodeType]);\n    }\n\n    if (shouldIgnoreKey(nodeType)) continue;\n\n    if (t.TYPES.indexOf(nodeType) < 0) {\n      throw new Error(messages.get(\"traverseVerifyNodeType\", nodeType));\n    }\n\n    var visitors = visitor[nodeType];\n    if (typeof visitors === \"object\") {\n      for (var visitorKey in visitors) {\n        if (visitorKey === \"enter\" || visitorKey === \"exit\") {\n          // verify that it just contains functions\n          validateVisitorMethods(nodeType + \".\" + visitorKey, visitors[visitorKey]);\n        } else {\n          throw new Error(messages.get(\"traverseVerifyVisitorProperty\", nodeType, visitorKey));\n        }\n      }\n    }\n  }\n\n  visitor._verified = true;\n}\n\nfunction validateVisitorMethods(path, val) {\n  var fns = [].concat(val);\n  for (var _iterator2 = fns, _isArray2 = Array.isArray(_iterator2), _i5 = 0, _iterator2 = _isArray2 ? _iterator2 : _getIterator(_iterator2);;) {\n    var _ref2;\n\n    if (_isArray2) {\n      if (_i5 >= _iterator2.length) break;\n      _ref2 = _iterator2[_i5++];\n    } else {\n      _i5 = _iterator2.next();\n      if (_i5.done) break;\n      _ref2 = _i5.value;\n    }\n\n    var fn = _ref2;\n\n    if (typeof fn !== \"function\") {\n      throw new TypeError(\"Non-function found defined in \" + path + \" with type \" + typeof fn);\n    }\n  }\n}\n\nfunction merge(visitors) {\n  var states = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var rootVisitor = {};\n\n  for (var i = 0; i < visitors.length; i++) {\n    var visitor = visitors[i];\n    var state = states[i];\n\n    explode(visitor);\n\n    for (var type in visitor) {\n      var visitorType = visitor[type];\n\n      // if we have state then overload the callbacks to take it\n      if (state) visitorType = wrapWithState(visitorType, state);\n\n      var nodeVisitor = rootVisitor[type] = rootVisitor[type] || {};\n      mergePair(nodeVisitor, visitorType);\n    }\n  }\n\n  return rootVisitor;\n}\n\nfunction wrapWithState(oldVisitor, state) {\n  var newVisitor = {};\n\n  for (var key in oldVisitor) {\n    var fns = oldVisitor[key];\n\n    // not an enter/exit array of callbacks\n    if (!Array.isArray(fns)) continue;\n\n    fns = fns.map(function (fn) {\n      var newFn = function newFn(path) {\n        return fn.call(state, path, state);\n      };\n      newFn.toString = function () {\n        return fn.toString();\n      };\n      return newFn;\n    });\n\n    newVisitor[key] = fns;\n  }\n\n  return newVisitor;\n}\n\nfunction ensureEntranceObjects(obj) {\n  for (var key in obj) {\n    if (shouldIgnoreKey(key)) continue;\n\n    var fns = obj[key];\n    if (typeof fns === \"function\") {\n      obj[key] = { enter: fns };\n    }\n  }\n}\n\nfunction ensureCallbackArrays(obj) {\n  if (obj.enter && !Array.isArray(obj.enter)) obj.enter = [obj.enter];\n  if (obj.exit && !Array.isArray(obj.exit)) obj.exit = [obj.exit];\n}\n\nfunction wrapCheck(wrapper, fn) {\n  var newFn = function newFn(path) {\n    if (wrapper.checkPath(path)) {\n      return fn.apply(this, arguments);\n    }\n  };\n  newFn.toString = function () {\n    return fn.toString();\n  };\n  return newFn;\n}\n\nfunction shouldIgnoreKey(key) {\n  // internal/hidden key\n  if (key[0] === \"_\") return true;\n\n  // ignore function keys\n  if (key === \"enter\" || key === \"exit\" || key === \"shouldSkip\") return true;\n\n  // ignore other options\n  if (key === \"blacklist\" || key === \"noScope\" || key === \"skipKeys\") return true;\n\n  return false;\n}\n\nfunction mergePair(dest, src) {\n  for (var key in src) {\n    dest[key] = [].concat(dest[key] || [], src[key]);\n  }\n}"]}