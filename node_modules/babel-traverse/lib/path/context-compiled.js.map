{"version":3,"sources":["context.js"],"names":[],"mappings":"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","file":"context-compiled.js","sourcesContent":["// This file contains methods responsible for maintaining a TraversalContext.\n\n\"use strict\";\n\nvar _getIterator = require(\"babel-runtime/core-js/get-iterator\")[\"default\"];\n\nvar _interopRequireDefault = require(\"babel-runtime/helpers/interop-require-default\")[\"default\"];\n\nexports.__esModule = true;\nexports.call = call;\nexports._call = _call;\nexports.isBlacklisted = isBlacklisted;\nexports.visit = visit;\nexports.skip = skip;\nexports.skipKey = skipKey;\nexports.stop = stop;\nexports.setScope = setScope;\nexports.setContext = setContext;\nexports.resync = resync;\nexports._resyncParent = _resyncParent;\nexports._resyncKey = _resyncKey;\nexports._resyncList = _resyncList;\nexports._resyncRemoved = _resyncRemoved;\nexports.popContext = popContext;\nexports.pushContext = pushContext;\nexports.setup = setup;\nexports.setKey = setKey;\nexports.requeue = requeue;\nexports._getQueueContexts = _getQueueContexts;\n\nvar _index = require(\"../index\");\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction call(key) {\n  var opts = this.opts;\n\n  this.debug(function () {\n    return key;\n  });\n\n  if (this.node) {\n    if (this._call(opts[key])) return true;\n  }\n\n  if (this.node) {\n    return this._call(opts[this.node.type] && opts[this.node.type][key]);\n  }\n\n  return false;\n}\n\nfunction _call(fns) {\n  if (!fns) return false;\n\n  for (var _i = 0; _i < fns.length; _i++) {\n    var fn = fns[_i];\n    if (!fn) continue;\n\n    var node = this.node;\n    if (!node) return true;\n\n    var ret = fn.call(this.state, this, this.state);\n    if (ret) throw new Error(\"Unexpected return value from visitor method \" + fn);\n\n    // node has been replaced, it will have been requeued\n    if (this.node !== node) return true;\n\n    if (this.shouldStop || this.shouldSkip || this.removed) return true;\n  }\n\n  return false;\n}\n\nfunction isBlacklisted() {\n  var blacklist = this.opts.blacklist;\n  return blacklist && blacklist.indexOf(this.node.type) > -1;\n}\n\nfunction visit() {\n  if (!this.node) {\n    return false;\n  }\n\n  if (this.isBlacklisted()) {\n    return false;\n  }\n\n  if (this.opts.shouldSkip && this.opts.shouldSkip(this)) {\n    return false;\n  }\n\n  if (this.call(\"enter\") || this.shouldSkip) {\n    this.debug(function () {\n      return \"Skip...\";\n    });\n    return this.shouldStop;\n  }\n\n  this.debug(function () {\n    return \"Recursing into...\";\n  });\n  _index2[\"default\"].node(this.node, this.opts, this.scope, this.state, this, this.skipKeys);\n\n  this.call(\"exit\");\n\n  return this.shouldStop;\n}\n\nfunction skip() {\n  this.shouldSkip = true;\n}\n\nfunction skipKey(key) {\n  this.skipKeys[key] = true;\n}\n\nfunction stop() {\n  this.shouldStop = true;\n  this.shouldSkip = true;\n}\n\nfunction setScope() {\n  if (this.opts && this.opts.noScope) return;\n\n  var target = this.context && this.context.scope;\n\n  if (!target) {\n    var path = this.parentPath;\n    while (path && !target) {\n      if (path.opts && path.opts.noScope) return;\n\n      target = path.scope;\n      path = path.parentPath;\n    }\n  }\n\n  this.scope = this.getScope(target);\n  if (this.scope) this.scope.init();\n}\n\nfunction setContext(context) {\n  this.shouldSkip = false;\n  this.shouldStop = false;\n  this.removed = false;\n  this.skipKeys = {};\n\n  if (context) {\n    this.context = context;\n    this.state = context.state;\n    this.opts = context.opts;\n  }\n\n  this.setScope();\n\n  return this;\n}\n\n/**\n * Here we resync the node paths `key` and `container`. If they've changed according\n * to what we have stored internally then we attempt to resync by crawling and looking\n * for the new values.\n */\n\nfunction resync() {\n  if (this.removed) return;\n\n  this._resyncParent();\n  this._resyncList();\n  this._resyncKey();\n  //this._resyncRemoved();\n}\n\nfunction _resyncParent() {\n  if (this.parentPath) {\n    this.parent = this.parentPath.node;\n  }\n}\n\nfunction _resyncKey() {\n  if (!this.container) return;\n\n  if (this.node === this.container[this.key]) return;\n\n  // grrr, path key is out of sync. this is likely due to a modification to the AST\n  // not done through our path APIs\n\n  if (Array.isArray(this.container)) {\n    for (var i = 0; i < this.container.length; i++) {\n      if (this.container[i] === this.node) {\n        return this.setKey(i);\n      }\n    }\n  } else {\n    for (var key in this.container) {\n      if (this.container[key] === this.node) {\n        return this.setKey(key);\n      }\n    }\n  }\n\n  // ¯\\_(ツ)_/¯ who knows where it's gone lol\n  this.key = null;\n}\n\nfunction _resyncList() {\n  if (!this.parent || !this.inList) return;\n\n  var newContainer = this.parent[this.listKey];\n  if (this.container === newContainer) return;\n\n  // container is out of sync. this is likely the result of it being reassigned\n  this.container = newContainer || null;\n}\n\nfunction _resyncRemoved() {\n  if (this.key == null || !this.container || this.container[this.key] !== this.node) {\n    this._markRemoved();\n  }\n}\n\nfunction popContext() {\n  this.contexts.pop();\n  this.setContext(this.contexts[this.contexts.length - 1]);\n}\n\nfunction pushContext(context) {\n  this.contexts.push(context);\n  this.setContext(context);\n}\n\nfunction setup(parentPath, container, listKey, key) {\n  this.inList = !!listKey;\n  this.listKey = listKey;\n  this.parentKey = listKey || key;\n  this.container = container;\n\n  this.parentPath = parentPath || this.parentPath;\n  this.setKey(key);\n}\n\nfunction setKey(key) {\n  this.key = key;\n  this.node = this.container[this.key];\n  this.type = this.node && this.node.type;\n}\n\nfunction requeue() {\n  var pathToQueue = arguments.length <= 0 || arguments[0] === undefined ? this : arguments[0];\n\n  if (pathToQueue.removed) return;\n\n  // TODO(loganfsmyth): This should be switched back to queue in parent contexts\n  // automatically once T2892 and T7160 have been resolved. See T7166.\n  // let contexts = this._getQueueContexts();\n  var contexts = this.contexts;\n\n  for (var _iterator = contexts, _isArray = Array.isArray(_iterator), _i2 = 0, _iterator = _isArray ? _iterator : _getIterator(_iterator);;) {\n    var _ref;\n\n    if (_isArray) {\n      if (_i2 >= _iterator.length) break;\n      _ref = _iterator[_i2++];\n    } else {\n      _i2 = _iterator.next();\n      if (_i2.done) break;\n      _ref = _i2.value;\n    }\n\n    var context = _ref;\n\n    context.maybeQueue(pathToQueue);\n  }\n}\n\nfunction _getQueueContexts() {\n  var path = this;\n  var contexts = this.contexts;\n  while (!contexts.length) {\n    path = path.parentPath;\n    contexts = path.contexts;\n  }\n  return contexts;\n}"]}