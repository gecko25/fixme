{"version":3,"sources":["es6.promise.js"],"names":[],"mappings":"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","file":"es6.promise-compiled.js","sourcesContent":["'use strict';\nvar $          = require('./$')\n  , LIBRARY    = require('./$.library')\n  , global     = require('./$.global')\n  , ctx        = require('./$.ctx')\n  , classof    = require('./$.classof')\n  , $export    = require('./$.export')\n  , isObject   = require('./$.is-object')\n  , anObject   = require('./$.an-object')\n  , aFunction  = require('./$.a-function')\n  , strictNew  = require('./$.strict-new')\n  , forOf      = require('./$.for-of')\n  , setProto   = require('./$.set-proto').set\n  , same       = require('./$.same-value')\n  , SPECIES    = require('./$.wks')('species')\n  , speciesConstructor = require('./$.species-constructor')\n  , asap       = require('./$.microtask')\n  , PROMISE    = 'Promise'\n  , process    = global.process\n  , isNode     = classof(process) == 'process'\n  , P          = global[PROMISE]\n  , Wrapper;\n\nvar testResolve = function(sub){\n  var test = new P(function(){});\n  if(sub)test.constructor = Object;\n  return P.resolve(test) === test;\n};\n\nvar USE_NATIVE = function(){\n  var works = false;\n  function P2(x){\n    var self = new P(x);\n    setProto(self, P2.prototype);\n    return self;\n  }\n  try {\n    works = P && P.resolve && testResolve();\n    setProto(P2, P);\n    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});\n    // actual Firefox has broken subclass support, test that\n    if(!(P2.resolve(5).then(function(){}) instanceof P2)){\n      works = false;\n    }\n    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162\n    if(works && require('./$.descriptors')){\n      var thenableThenGotten = false;\n      P.resolve($.setDesc({}, 'then', {\n        get: function(){ thenableThenGotten = true; }\n      }));\n      works = thenableThenGotten;\n    }\n  } catch(e){ works = false; }\n  return works;\n}();\n\n// helpers\nvar sameConstructor = function(a, b){\n  // library wrapper special case\n  if(LIBRARY && a === P && b === Wrapper)return true;\n  return same(a, b);\n};\nvar getConstructor = function(C){\n  var S = anObject(C)[SPECIES];\n  return S != undefined ? S : C;\n};\nvar isThenable = function(it){\n  var then;\n  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;\n};\nvar PromiseCapability = function(C){\n  var resolve, reject;\n  this.promise = new C(function($$resolve, $$reject){\n    if(resolve !== undefined || reject !== undefined)throw TypeError('Bad Promise constructor');\n    resolve = $$resolve;\n    reject  = $$reject;\n  });\n  this.resolve = aFunction(resolve),\n  this.reject  = aFunction(reject)\n};\nvar perform = function(exec){\n  try {\n    exec();\n  } catch(e){\n    return {error: e};\n  }\n};\nvar notify = function(record, isReject){\n  if(record.n)return;\n  record.n = true;\n  var chain = record.c;\n  asap(function(){\n    var value = record.v\n      , ok    = record.s == 1\n      , i     = 0;\n    var run = function(reaction){\n      var handler = ok ? reaction.ok : reaction.fail\n        , resolve = reaction.resolve\n        , reject  = reaction.reject\n        , result, then;\n      try {\n        if(handler){\n          if(!ok)record.h = true;\n          result = handler === true ? value : handler(value);\n          if(result === reaction.promise){\n            reject(TypeError('Promise-chain cycle'));\n          } else if(then = isThenable(result)){\n            then.call(result, resolve, reject);\n          } else resolve(result);\n        } else reject(value);\n      } catch(e){\n        reject(e);\n      }\n    };\n    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach\n    chain.length = 0;\n    record.n = false;\n    if(isReject)setTimeout(function(){\n      var promise = record.p\n        , handler, console;\n      if(isUnhandled(promise)){\n        if(isNode){\n          process.emit('unhandledRejection', value, promise);\n        } else if(handler = global.onunhandledrejection){\n          handler({promise: promise, reason: value});\n        } else if((console = global.console) && console.error){\n          console.error('Unhandled promise rejection', value);\n        }\n      } record.a = undefined;\n    }, 1);\n  });\n};\nvar isUnhandled = function(promise){\n  var record = promise._d\n    , chain  = record.a || record.c\n    , i      = 0\n    , reaction;\n  if(record.h)return false;\n  while(chain.length > i){\n    reaction = chain[i++];\n    if(reaction.fail || !isUnhandled(reaction.promise))return false;\n  } return true;\n};\nvar $reject = function(value){\n  var record = this;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  record.v = value;\n  record.s = 2;\n  record.a = record.c.slice();\n  notify(record, true);\n};\nvar $resolve = function(value){\n  var record = this\n    , then;\n  if(record.d)return;\n  record.d = true;\n  record = record.r || record; // unwrap\n  try {\n    if(record.p === value)throw TypeError(\"Promise can't be resolved itself\");\n    if(then = isThenable(value)){\n      asap(function(){\n        var wrapper = {r: record, d: false}; // wrap\n        try {\n          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));\n        } catch(e){\n          $reject.call(wrapper, e);\n        }\n      });\n    } else {\n      record.v = value;\n      record.s = 1;\n      notify(record, false);\n    }\n  } catch(e){\n    $reject.call({r: record, d: false}, e); // wrap\n  }\n};\n\n// constructor polyfill\nif(!USE_NATIVE){\n  // 25.4.3.1 Promise(executor)\n  P = function Promise(executor){\n    aFunction(executor);\n    var record = this._d = {\n      p: strictNew(this, P, PROMISE),         // <- promise\n      c: [],                                  // <- awaiting reactions\n      a: undefined,                           // <- checked in isUnhandled reactions\n      s: 0,                                   // <- state\n      d: false,                               // <- done\n      v: undefined,                           // <- value\n      h: false,                               // <- handled rejection\n      n: false                                // <- notify\n    };\n    try {\n      executor(ctx($resolve, record, 1), ctx($reject, record, 1));\n    } catch(err){\n      $reject.call(record, err);\n    }\n  };\n  require('./$.redefine-all')(P.prototype, {\n    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)\n    then: function then(onFulfilled, onRejected){\n      var reaction = new PromiseCapability(speciesConstructor(this, P))\n        , promise  = reaction.promise\n        , record   = this._d;\n      reaction.ok   = typeof onFulfilled == 'function' ? onFulfilled : true;\n      reaction.fail = typeof onRejected == 'function' && onRejected;\n      record.c.push(reaction);\n      if(record.a)record.a.push(reaction);\n      if(record.s)notify(record, false);\n      return promise;\n    },\n    // 25.4.5.1 Promise.prototype.catch(onRejected)\n    'catch': function(onRejected){\n      return this.then(undefined, onRejected);\n    }\n  });\n}\n\n$export($export.G + $export.W + $export.F * !USE_NATIVE, {Promise: P});\nrequire('./$.set-to-string-tag')(P, PROMISE);\nrequire('./$.set-species')(PROMISE);\nWrapper = require('./$.core')[PROMISE];\n\n// statics\n$export($export.S + $export.F * !USE_NATIVE, PROMISE, {\n  // 25.4.4.5 Promise.reject(r)\n  reject: function reject(r){\n    var capability = new PromiseCapability(this)\n      , $$reject   = capability.reject;\n    $$reject(r);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * (!USE_NATIVE || testResolve(true)), PROMISE, {\n  // 25.4.4.6 Promise.resolve(x)\n  resolve: function resolve(x){\n    // instanceof instead of internal slot check because we should fix it without replacement native Promise core\n    if(x instanceof P && sameConstructor(x.constructor, this))return x;\n    var capability = new PromiseCapability(this)\n      , $$resolve  = capability.resolve;\n    $$resolve(x);\n    return capability.promise;\n  }\n});\n$export($export.S + $export.F * !(USE_NATIVE && require('./$.iter-detect')(function(iter){\n  P.all(iter)['catch'](function(){});\n})), PROMISE, {\n  // 25.4.4.1 Promise.all(iterable)\n  all: function all(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , resolve    = capability.resolve\n      , reject     = capability.reject\n      , values     = [];\n    var abrupt = perform(function(){\n      forOf(iterable, false, values.push, values);\n      var remaining = values.length\n        , results   = Array(remaining);\n      if(remaining)$.each.call(values, function(promise, index){\n        var alreadyCalled = false;\n        C.resolve(promise).then(function(value){\n          if(alreadyCalled)return;\n          alreadyCalled = true;\n          results[index] = value;\n          --remaining || resolve(results);\n        }, reject);\n      });\n      else resolve(results);\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  },\n  // 25.4.4.4 Promise.race(iterable)\n  race: function race(iterable){\n    var C          = getConstructor(this)\n      , capability = new PromiseCapability(C)\n      , reject     = capability.reject;\n    var abrupt = perform(function(){\n      forOf(iterable, false, function(promise){\n        C.resolve(promise).then(capability.resolve, reject);\n      });\n    });\n    if(abrupt)reject(abrupt.error);\n    return capability.promise;\n  }\n});"]}