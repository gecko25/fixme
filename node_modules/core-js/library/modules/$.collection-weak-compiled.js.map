{"version":3,"sources":["$.collection-weak.js"],"names":[],"mappings":"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","file":"$.collection-weak-compiled.js","sourcesContent":["'use strict';\nvar hide              = require('./$.hide')\n  , redefineAll       = require('./$.redefine-all')\n  , anObject          = require('./$.an-object')\n  , isObject          = require('./$.is-object')\n  , strictNew         = require('./$.strict-new')\n  , forOf             = require('./$.for-of')\n  , createArrayMethod = require('./$.array-methods')\n  , $has              = require('./$.has')\n  , WEAK              = require('./$.uid')('weak')\n  , isExtensible      = Object.isExtensible || isObject\n  , arrayFind         = createArrayMethod(5)\n  , arrayFindIndex    = createArrayMethod(6)\n  , id                = 0;\n\n// fallback for frozen keys\nvar frozenStore = function(that){\n  return that._l || (that._l = new FrozenStore);\n};\nvar FrozenStore = function(){\n  this.a = [];\n};\nvar findFrozen = function(store, key){\n  return arrayFind(store.a, function(it){\n    return it[0] === key;\n  });\n};\nFrozenStore.prototype = {\n  get: function(key){\n    var entry = findFrozen(this, key);\n    if(entry)return entry[1];\n  },\n  has: function(key){\n    return !!findFrozen(this, key);\n  },\n  set: function(key, value){\n    var entry = findFrozen(this, key);\n    if(entry)entry[1] = value;\n    else this.a.push([key, value]);\n  },\n  'delete': function(key){\n    var index = arrayFindIndex(this.a, function(it){\n      return it[0] === key;\n    });\n    if(~index)this.a.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){\n    var C = wrapper(function(that, iterable){\n      strictNew(that, C, NAME);\n      that._i = id++;      // collection id\n      that._l = undefined; // leak store for frozen objects\n      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function(key){\n        if(!isObject(key))return false;\n        if(!isExtensible(key))return frozenStore(this)['delete'](key);\n        return $has(key, WEAK) && $has(key[WEAK], this._i) && delete key[WEAK][this._i];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key){\n        if(!isObject(key))return false;\n        if(!isExtensible(key))return frozenStore(this).has(key);\n        return $has(key, WEAK) && $has(key[WEAK], this._i);\n      }\n    });\n    return C;\n  },\n  def: function(that, key, value){\n    if(!isExtensible(anObject(key))){\n      frozenStore(that).set(key, value);\n    } else {\n      $has(key, WEAK) || hide(key, WEAK, {});\n      key[WEAK][that._i] = value;\n    } return that;\n  },\n  frozenStore: frozenStore,\n  WEAK: WEAK\n};"]}