{"version":3,"sources":["test.js"],"names":[],"mappings":"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","file":"test-compiled.js","sourcesContent":["require('./source-map-support').install({\n  emptyCacheBetweenOperations: true // Needed to be able to test for failure\n});\n\nvar SourceMapGenerator = require('source-map').SourceMapGenerator;\nvar child_process = require('child_process');\nvar assert = require('assert');\nvar fs = require('fs');\n\nfunction compareLines(actual, expected) {\n  assert(actual.length >= expected.length, 'got ' + actual.length + ' lines but expected at least ' + expected.length + ' lines');\n  for (var i = 0; i < expected.length; i++) {\n    // Some tests are regular expressions because the output format changed slightly between node v0.9.2 and v0.9.3\n    if (expected[i] instanceof RegExp) {\n      assert(expected[i].test(actual[i]), JSON.stringify(actual[i]) + ' does not match ' + expected[i]);\n    } else {\n      assert.equal(actual[i], expected[i]);\n    }\n  }\n}\n\nfunction createEmptySourceMap() {\n  return new SourceMapGenerator({\n    file: '.generated.js',\n    sourceRoot: '.'\n  });\n}\n\nfunction createSourceMapWithGap() {\n  var sourceMap = createEmptySourceMap();\n  sourceMap.addMapping({\n    generated: { line: 100, column: 0 },\n    original: { line: 100, column: 0 },\n    source: '.original.js'\n  });\n  return sourceMap;\n}\n\nfunction createSingleLineSourceMap() {\n  var sourceMap = createEmptySourceMap();\n  sourceMap.addMapping({\n    generated: { line: 1, column: 0 },\n    original: { line: 1, column: 0 },\n    source: '.original.js'\n  });\n  return sourceMap;\n}\n\nfunction createMultiLineSourceMap() {\n  var sourceMap = createEmptySourceMap();\n  for (var i = 1; i <= 100; i++) {\n    sourceMap.addMapping({\n      generated: { line: i, column: 0 },\n      original: { line: 1000 + i, column: 99 + i },\n      source: 'line' + i + '.js'\n    });\n  }\n  return sourceMap;\n}\n\nfunction createMultiLineSourceMapWithSourcesContent() {\n  var sourceMap = createEmptySourceMap();\n  var original = new Array(1001).join('\\n');\n  for (var i = 1; i <= 100; i++) {\n    sourceMap.addMapping({\n      generated: { line: i, column: 0 },\n      original: { line: 1000 + i, column: 4 },\n      source: 'original.js'\n    });\n    original += '    line ' + i + '\\n';\n  }\n  sourceMap.setSourceContent('original.js', original);\n  return sourceMap;\n}\n\nfunction compareStackTrace(sourceMap, source, expected) {\n  // Check once with a separate source map\n  fs.writeFileSync('.generated.js.map', sourceMap);\n  fs.writeFileSync('.generated.js', 'exports.test = function() {' +\n    source.join('\\n') + '};//@ sourceMappingURL=.generated.js.map');\n  try {\n    delete require.cache[require.resolve('./.generated')];\n    require('./.generated').test();\n  } catch (e) {\n    compareLines(e.stack.split('\\n'), expected);\n  }\n  fs.unlinkSync('.generated.js');\n  fs.unlinkSync('.generated.js.map');\n\n  // Check again with an inline source map (in a data URL)\n  fs.writeFileSync('.generated.js', 'exports.test = function() {' +\n    source.join('\\n') + '};//@ sourceMappingURL=data:application/json;base64,' +\n    new Buffer(sourceMap.toString()).toString('base64'));\n  try {\n    delete require.cache[require.resolve('./.generated')];\n    require('./.generated').test();\n  } catch (e) {\n    compareLines(e.stack.split('\\n'), expected);\n  }\n  fs.unlinkSync('.generated.js');\n}\n\nfunction compareStdout(done, sourceMap, source, expected) {\n  fs.writeFileSync('.original.js', 'this is the original code');\n  fs.writeFileSync('.generated.js.map', sourceMap);\n  fs.writeFileSync('.generated.js', source.join('\\n') +\n    '//@ sourceMappingURL=.generated.js.map');\n  child_process.exec('node ./.generated', function(error, stdout, stderr) {\n    try {\n      compareLines((stdout + stderr).trim().split('\\n'), expected);\n    } catch (e) {\n      return done(e);\n    }\n    fs.unlinkSync('.generated.js');\n    fs.unlinkSync('.generated.js.map');\n    fs.unlinkSync('.original.js');\n    done();\n  });\n}\n\nit('normal throw', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('throw inside function', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'function foo() {',\n    '  throw new Error(\"test\");',\n    '}',\n    'foo();'\n  ], [\n    'Error: test',\n    /^    at foo \\(.*\\/line2\\.js:1002:102\\)$/,\n    /^    at Object\\.exports\\.test \\(.*\\/line4\\.js:1004:104\\)$/\n  ]);\n});\n\nit('throw inside function inside function', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'function foo() {',\n    '  function bar() {',\n    '    throw new Error(\"test\");',\n    '  }',\n    '  bar();',\n    '}',\n    'foo();'\n  ], [\n    'Error: test',\n    /^    at bar \\(.*\\/line3\\.js:1003:103\\)$/,\n    /^    at foo \\(.*\\/line5\\.js:1005:105\\)$/,\n    /^    at Object\\.exports\\.test \\(.*\\/line7\\.js:1007:107\\)$/\n  ]);\n});\n\nit('eval', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"throw new Error(\\'test\\')\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.eval \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('eval inside eval', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"eval(\\'throw new Error(\\\\\"test\\\\\")\\')\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.eval \\(eval at <anonymous> \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.eval \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('eval inside function', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'function foo() {',\n    '  eval(\"throw new Error(\\'test\\')\");',\n    '}',\n    'foo();'\n  ], [\n    'Error: test',\n    /^    at eval \\(eval at foo \\(.*\\/line2\\.js:1002:102\\)/,\n    /^    at foo \\(.*\\/line2\\.js:1002:102\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line4\\.js:1004:104\\)$/\n  ]);\n});\n\nit('eval with sourceURL', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"throw new Error(\\'test\\')//@ sourceURL=sourceURL.js\");'\n  ], [\n    'Error: test',\n    '    at Object.eval (sourceURL.js:1:7)',\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('eval with sourceURL inside eval', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"eval(\\'throw new Error(\\\\\"test\\\\\")//@ sourceURL=sourceURL.js\\')\");'\n  ], [\n    'Error: test',\n    '    at Object.eval (sourceURL.js:1:7)',\n    /^    at Object\\.eval \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('function constructor', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'throw new Function(\")\");'\n  ], [\n    'SyntaxError: Unexpected token )',\n    /^    at Object\\.Function \\((?:unknown source|<anonymous>)\\)$/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/,\n  ]);\n});\n\nit('throw with empty source map', function() {\n  compareStackTrace(createEmptySourceMap(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/.generated.js:1:96\\)$/\n  ]);\n});\n\nit('throw with source map with gap', function() {\n  compareStackTrace(createSourceMapWithGap(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/.generated.js:1:96\\)$/\n  ]);\n});\n\nit('sourcesContent with data URL', function() {\n  compareStackTrace(createMultiLineSourceMapWithSourcesContent(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/original.js:1001:5\\)$/\n  ]);\n});\n\nit('default options', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);',\n    'process.nextTick(function() { process.exit(1); });'\n  ], [\n    /\\/.original\\.js:1$/,\n    'this is the original code',\n    '^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.original\\.js:1:1\\)$/\n  ]);\n});\n\nit('handleUncaughtExceptions is true', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install({ handleUncaughtExceptions: true });',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.original\\.js:1$/,\n    'this is the original code',\n    '^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.original\\.js:1:1\\)$/\n  ]);\n});\n\nit('handleUncaughtExceptions is false', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install({ handleUncaughtExceptions: false });',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.generated.js:2$/,\n    'function foo() { throw new Error(\"this is the error\"); }',\n    '                       ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.original\\.js:1:1\\)$/\n  ]);\n});\n\nit('default options with empty source map', function(done) {\n  compareStdout(done, createEmptySourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.generated.js:2$/,\n    'function foo() { throw new Error(\"this is the error\"); }',\n    '                       ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:2:24\\)$/\n  ]);\n});\n\nit('default options with source map with gap', function(done) {\n  compareStdout(done, createSourceMapWithGap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.generated.js:2$/,\n    'function foo() { throw new Error(\"this is the error\"); }',\n    '                       ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:2:24\\)$/\n  ]);\n});\n\nit('specifically requested error source', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'var sms = require(\"./source-map-support\");',\n    'sms.install({ handleUncaughtExceptions: false });',\n    'process.on(\"uncaughtException\", function (e) { console.log(\"SRC:\" + sms.getErrorSource(e)); });',\n    'process.nextTick(foo);'\n  ], [\n    'SRC:',\n    /\\/.original.js:1$/,\n    'this is the original code',\n    '^'\n  ]);\n});\n\nit('sourcesContent', function(done) {\n  compareStdout(done, createMultiLineSourceMapWithSourcesContent(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);',\n    'process.nextTick(function() { process.exit(1); });'\n  ], [\n    /\\/original\\.js:1002$/,\n    '    line 2',\n    '    ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/original\\.js:1002:5\\)$/\n  ]);\n});\n\nit('missing source maps should also be cached', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'var count = 0;',\n    'function foo() {',\n    '  console.log(new Error(\"this is the error\").stack.split(\"\\\\n\").slice(0, 2).join(\"\\\\n\"));',\n    '}',\n    'require(\"./source-map-support\").install({',\n    '  retrieveSourceMap: function(name) {',\n    '    if (/\\\\.generated.js$/.test(name)) count++;',\n    '    return null;',\n    '  }',\n    '});',\n    'process.nextTick(foo);',\n    'process.nextTick(foo);',\n    'process.nextTick(function() { console.log(count); });',\n  ], [\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:4:15\\)$/,\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:4:15\\)$/,\n    '1', // The retrieval should only be attempted once\n  ]);\n});\n"]}